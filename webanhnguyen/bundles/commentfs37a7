function LoginFacebook(n){FB.login(function(t){t.status==="connected"?getLogin(n):console.log("User cancelled login or did not fully authorize.")},{scope:"email,public_profile,user_friends"})}function getLogin(n){FB.api("/me?fields=name,email",function(t){var i="",r="";t&&(i=t.name,r=t.email,UtilCommentFS.setCookie(UtilCommentFS.configConstant().nameCustomerCookie,i,1),UtilCommentFS.setCookie(UtilCommentFS.configConstant().nameEmailCookie,r,1),$(".fcm-login").hide("slow"),n.closest(".fcm-login").prev().find(".fshop-cmt-textarea").focus(),n.closest(".fcm-login").prev().find(".fshop-cmt-tabtn").show())})}var CommentFptShop,UtilCommentFS,ToastFts;jQuery(document).ready(function(n){if(n("#wrapper-nt-comment").length>0){var t=new CommentFptShop({moduleId:n("#wrapper-nt-comment").attr("data-modul")});t.init()}});CommentFptShop=function(n){this.option=jQuery.extend({moduleId:0},n)};CommentFptShop.prototype.init=function(){var n=this;$(".scrollerbar").css("padding-right","15px");$("#wrapper-nt-comment").html(n.buildHtmlTemplateInit());$(document).on("click",".fcm-login-close",function(){$(this).closest(".fcm-login").hide("slow");$(document).find(".fshop-cmt-tabtn").show()});$(document).on("click",".fcm-login-fb",function(){LoginFacebook($(this))});$(document).on("click",".new-comment-ntc a",function(){var n=$("#listCommentCate").data("view");$("#listCommentCate").prepend(n);$(this).closest(".new-comment-ntc").remove()});n.loadComment(undefined,undefined,undefined,1,!1);n.filterComment();n.sortComment();n.sendComment();n.likeComment();n.replyComment();n.pagingComment();n.setIconEmotionComment()};CommentFptShop.prototype.buildHtmlTemplateInit=function(){return $("<div class='fshop-comment'>\n<div class='fshop-cmttitle'>\nBình luận<span class='fshop-cmtcount'>0<\/span>\n<\/div>\n<div class='fshop-cmt-head'>\n<div class='clearfix'>\n<div class='fshop-cmt-col6'>\n<div class='fshop-cmt-form'>\n<input id='txt-filter-comment' type='text' class='fshop-cmt-ftxt' placeholder='Tìm kiếm bình luận...'>\n<div class='fshop-cmt-fsbox'>\n<select class='fshop-cmt-fselect' id='select-condition-filter-comment'>\n<option value='0'>Tất cả<\/option>\n<option value='2'>Email<\/option>\n<option value='3'>Tên<\/option>\n<\/select>\n<\/div>\n<\/div>\n<\/div>\n<div class='fshop-cmt-col6'>\n<div class='fshop-cm-hsort'>\n<span data-value='1' class='sort-comment active'>Mới nhất<\/span> | <span class='sort-comment' data-value='0'>Quan tâm nhất<\/span>\n<\/div>\n<\/div>\n<\/div>\n<\/div>\n<div class='fshop-cmt-main'>\n<div class='clearfix'>\n<form>\n<div class='fshop-cmt-tabox'>\n<textarea id='txt-comment-cate' class='fshop-cmt-textarea' rows='3' placeholder='Viết bình luận của bạn...'><\/textarea>\n<input type='submit' class='fshop-cmt-tabtn' value='Bình luận' id='btnCommentCate'>\n<\/div>\n<\/form>\n<div class='fcm-login'>\n<div class='fcm-login-tb clearfix'>\n<span class='fcm-login-close'>×<\/span>\n<form id='register-information'>\n<div class='fcm-login-col'>\n<p class='fcm-login-title'>Nhập thông tin để bình luận:<\/p>\n<p><input class='fcm-login-txt' type='text' placeholder='Họ tên (bắt buộc)' name='name'/><\/p>\n<p><input class='fcm-login-txt' type='email' placeholder='Email' name='email'/><\/p>\n<p><input class='fcm-login-txt' type='text' placeholder='Điệnt thoại' name='phone'/><\/p>\n<p><input class='fcm-login-btn' type='submit' value='Bình luận' /><\/p>\n<\/div>\n<\/form>\n<div class='fcm-login-col'>\n<p class='fcm-login-title'>Hoặc đăng nhập qua: <\/p>\n<ul class='fcm-login-sul'>\n<li>\n<a href='javascript:void(0);' title='' class='fcm-login-fb'>\n<img src='/Content/Publishing/css/images/cmt/i_facebook.png?v=1' />\n<strong>Facebook<\/strong>\n<\/a>\n<\/li>\n<\/ul>\n<\/div>\n<\/div>\n<\/div>\n<div id='listCommentCate'>\n<\/div>\n<\/div>\n<\/div>\n<div class='fshop-cmt-cmtmores' id='ntc-viewmore-comment' data-page='2'>\n<span>Xem thêm <strong>0<\/strong> bình luận<\/span>\n<\/div>\n<\/div>")};CommentFptShop.prototype.pageID=0;CommentFptShop.prototype.loadComment=function(n,t,i,r,u){var f=this,h=n||"",c=t||0,l=i||1,s=r||1,e=$("#wrapper-nt-comment").find("#listCommentCate"),o=$("#wrapper-nt-comment").find("#ntc-viewmore-comment");e.length>0&&$.ajax({type:"GET",url:UtilCommentFS.linkAjax().linkApiGetListComment,data:{pageId:f.pageID,modulId:f.option.moduleId,referID:$(".fnews-detail-rating").length>0?$(".fnews-detail-rating").attr("data-id"):0,title:$("head title")[0].text,orderby:l,keyword:h,catesearch:c,page:s,isNewTemplate:!0},beforeSend:function(){u?o.html(UtilCommentFS.configConstant().imgLoading):e.html(UtilCommentFS.configConstant().imgBigLoading)}}).done(function(n){u?(e.append(n.View),o.attr("data-page",Number(s)+1)):e.html(n.View);n.TotalRecordRest>0?o.show().html("<span>Xem thêm <strong >0<\/strong> bình luận<\/span>").find("strong").text(n.TotalRecordRest):o.hide().attr("data-page",2);$("#wrapper-nt-comment").find(".fshop-cmtcount").text(n.Total);f.pageID=n.PageID;f.setLikeCommentInit();f.loadNewComment()})};CommentFptShop.prototype.loadNewComment=function(){var n=0;clearInterval(n);n=setInterval(function(){$.ajax({type:"GET",url:UtilCommentFS.linkAjax().linkGetNewComment,data:{pageId:this.pageID,modulId:this.option.moduleId,currentLastId:$("#listCommentCate").find(".fshop-cmt-numlike").first().attr("data-id")}}).done(function(n){if(n&&Number(n.Total)>0){var t=$("<div class='new-comment-ntc'>\n<span>Bạn có <strong>0<\/strong> comment mới.<\/span>\n<a href='javascript:void(0);'>Click để xem<\/a>\n<\/div>");$("#listCommentCate").data("view",n.View);$(document).find(".new-comment-ntc").remove();t.insertBefore(".fshop-cmt-head").fadeIn("300").find("strong").text(n.Total)}})}.bind(this),UtilCommentFS.configConstant().timerGetNewComment)};CommentFptShop.prototype.pagingComment=function(){var n=this;$("#wrapper-nt-comment").find("#ntc-viewmore-comment").off("click").on("click",function(){var i=$(this).attr("data-page"),t=n.getValueFilter();n.loadComment(t.keyword,t.searchin,t.sort,i,!0);$(".fshop-cmt-main").scrollTop($(".fshop-cmt-main")[0].scrollHeight)})};CommentFptShop.prototype.sendComment=function(){var n=this,t="";$("#wrapper-nt-comment").off("click",".fshop-cmt-tabtn").on("click",".fshop-cmt-tabtn",function(n){n.preventDefault();var i=$(this),t=i.prev().val(),r=i.attr("data-id")||0,u=i.closest(".fshop-cmt-tabox").parent().next();if(t=UtilCommentFS.standardizedString(t),$.type(t)==="undefined"||t.length<4){ToastFts.showToast({text:"Bạn cần nhập nội dung lớn hơn 3 ký tự.",type:"Warning"});return}});$(document).on("keyup",".fshop-cmt-textarea",function(){var i="",u="",f="",r=$(this),e=r.next(),o=r.closest(".fshop-cmt-tabox").parent().next(),s=r.attr("data-id")||0;t=r.val();t.length>3&&(e.hide(),o.show("slow",function(){$(this).find(".fcm-login-btn").off("click").on("click",function(h){h.preventDefault();var c=$(this);return(i=c.closest(".fcm-login-col").find('input[name="name"]').val(),f=c.closest(".fcm-login-col").find('input[name="email"]').val(),u=c.closest(".fcm-login-col").find('input[name="phone"]').val(),!i)?(ToastFts.showToast({text:"Bạn cần nhập họ tên!.",type:"Warning"}),!1):(o.hide("slow"),UtilCommentFS.resetInput([".fshop-cmt-textarea",".fcm-login-txt"]),$.ajax({type:"POST",url:UtilCommentFS.linkAjax().linkApiAddComment,data:{pageId:n.pageID,shopCommentID:s,content:t,name:i,email:f,phone:u}}).done(function(u){s===0?$("#wrapper-nt-comment").find("#listCommentCate").prepend(n.buildHtmlComment(!0,{id:u.ID,username:i,comment:t})):r.closest(".fshop-cmt-hide").after(n.buildHtmlComment(!1,{id:u.ID,username:i,comment:t})).hide();n.pageID=u.PageID;n.SendAnsync({linkAnsyn:UtilCommentFS.linkAjax().linkApiAsync,contenComment:t,ID:u.ID,title:$("head title")[0].text,modulId:n.option.moduleId});ToastFts.showToast({text:UtilCommentFS.configConstant().messageSuccess})}),e.show(),!1)})}))})};CommentFptShop.prototype.SendAnsync=function(n){$.post(n.linkAnsyn,{message:n.contenComment,commentId:n.ID,title:n.title,modulId:n.modulId},function(){console.log("da gui thong bao")})};CommentFptShop.prototype.filterComment=function(){var n=this;$("#wrapper-nt-comment").on("keyup","#txt-filter-comment",function(t){var i=n.getValueFilter();if(t.keyCode==13){if(!i.keyword)return alert("Bạn chưa nhập thông tin tìm kiếm"),!1;n.loadComment(i.keyword,i.searchin,i.sort,!1);$("#wrapper-nt-comment").find("#ntc-viewmore-comment").attr("data-page",2)}return!1})};CommentFptShop.prototype.sortComment=function(){var n=this;$("#wrapper-nt-comment").on("click",".fshop-cm-hsort span",function(){var i=$(this),t;i.closest(".fshop-cm-hsort").find(".active").removeClass("active");i.addClass("active");t=n.getValueFilter();n.loadComment(t.keyword,t.searchin,t.sort,!1);$("#wrapper-nt-comment").find("#ntc-viewmore-comment").attr("data-page",2)})};CommentFptShop.prototype.getValueFilter=function(){return $.extend({keyword:"",searchin:0,sort:1},{keyword:UtilCommentFS.standardizedString($("#wrapper-nt-comment").find("#txt-filter-comment").val()),searchin:$("#wrapper-nt-comment").find("#select-condition-filter-comment").val(),sort:$("#wrapper-nt-comment").find(".fshop-cm-hsort").find(".active").attr("data-value")})};CommentFptShop.prototype.likeComment=function(){var n=this;$("#wrapper-nt-comment").on("click",".fshop-cmt-btnlike",function(){var t=$(this),i=t.next(".fshop-cmt-numlike").attr("data-id"),r=t.next(".fshop-cmt-numlike").find("span");t.hasClass("liked")?(t.removeClass("liked"),r.text(Number(r.text())-1),t.text("Thích"),$.post(UtilCommentFS.linkAjax().linkApiUnLike,{CommentID:i}).done(function(){n.saveLikeCommentToCookie(i,!1)})):(t.addClass("liked"),r.text(Number(r.text())+1),t.text("Bỏ thích"),$.post(UtilCommentFS.linkAjax().linkApiLike,{CommentID:i}).done(function(){n.saveLikeCommentToCookie(i,!0)}))})};CommentFptShop.prototype.buildHtmlComment=function(n,t){return n?$(["<div class='fshop-cmt-item'>","<div class='fshop-cmt-ask'>","<div class='fshop-cmt-textmain'>"+t.comment+"<\/div>","<div class='fshop-cmt-bottmain clearfix'>","<div class='fshop-cmt-col6'>","<img class='fshop-cmt-avatar' src='http://fptshop.com.vn/Content/assest/images/no-avatar.png?v=9999' alt=''>","<span class='fshop-cmt-user'>","<strong>"+t.username+"<\/strong> - "+UtilCommentFS.getBackDate(new Date),"<\/span>","<\/div>","<div class='fshop-cmt-col6'>","<p class='fshop-cmt-relate'>","<span class='fshop-cmt-btnreply' data-id='"+t.id+"'>Trả lời<\/span>","<span class='fshop-cmt-btnlike'>Thích<\/span>","<span class='fshop-cmt-numlike' data-id='"+t.id+"'>","<img src='http://fptshop.com.vn/Content/Publishing/Comment/img/icon-numlike.png'>","<span class='number-like'>0<\/span>","<\/span>","<\/p>","<\/div>","<\/div>","<\/div>","<div class='fshop-cmt-reply fshop-cmt-hide'>","<form>","<div class='fshop-cmt-tabox'>","<textarea class='fshop-cmt-textarea' rows='2' placeholder='Viết bình luận của bạn...'><\/textarea>","<input data-id='"+t.id+"' type='button' class='fshop-cmt-tabtn btn-reply-comment' value='Bình luận'>","<\/div>","<\/form>","<\/div>","<\/div>"].join("\n")):$(["<div class='fshop-cmt-reply'>","<div class='fshop-cmt-textmain'>"+t.comment+"<\/div>","<div class='fshop-cmt-bottmain clearfix'>","<div class='fshop-cmt-col6'>","<img class='fshop-cmt-avatar' src='http://fptshop.com.vn/Content/assest/images/no-avatar.png?v=9999' alt=''>","<span class='fshop-cmt-user'>","<strong>"+t.username+"<\/strong><i><\/i> - "+UtilCommentFS.getBackDate(new Date),"<\/span>","<\/div>","<div class='fshop-cmt-col6'>","<p class='fshop-cmt-relate'>","<span class='fshop-cmt-btnlike'>Thích<\/span>","<span class='fshop-cmt-numlike' data-id='"+t.id+"'>","<img src='http://fptshop.com.vn/Content/Publishing/Comment/img/icon-numlike.png' alt=''>","<span class='number-like'>0<\/span>","<\/span>","<\/p>","<\/div>","<\/div>","<\/div>"].join("\n"))};CommentFptShop.prototype.replyComment=function(){$("#wrapper-nt-comment").on("click",".fshop-cmt-btnreply",function(){var n=$(this);n.closest(".fshop-cmt-ask").next().toggle(300)})};CommentFptShop.prototype.setLikeCommentInit=function(){var n=UtilCommentFS.getCookie(UtilCommentFS.configConstant().nameLikeCookie),t;$.trim(n)!==""&&(t=JSON.parse(n),$("#wrapper-nt-comment").find(".fshop-cmt-btnlike").each(function(){var n=$(this),i=n.next().attr("data-id");$.each(t,function(t,r){Number(i)===Number(r)&&n.addClass("liked").text("Bỏ thích")})}))};CommentFptShop.prototype.saveLikeCommentToCookie=function(n,t){var r=UtilCommentFS.getCookie(UtilCommentFS.configConstant().nameLikeCookie),i=[];$.trim(r)&&(i=JSON.parse(r));t?i.push(n):i=$.grep(i,function(t){return Number(t)!=Number(n)});UtilCommentFS.setCookie(UtilCommentFS.configConstant().nameLikeCookie,JSON.stringify(i),365)};CommentFptShop.prototype.setIconEmotionComment=function(){$(document).find("#ntc-wrapper-add-icon").find("span").off("click").on("click",function(){$(this).closest(".ntc-icon-smile").prev().find(".fshop-cmt-textarea").val($(this).html())})};UtilCommentFS=function(n){var t,i,r,u,f,e,o,s;return t=function(){var n="http://api.fptshop.com.vn/Ajax/Comment/";return{linkApiGetListComment:n+"GetListComment",linkApiAddComment:n+"AddComment",linkApiLike:n+"Like",linkApiUnLike:n+"Unlike",linkGetNewComment:n+"GetLastestComment",linkApiAsync:"http://api.fptshop.com.vn/message"}},i=function(t){var i=t,u="",r;return i&&(i=i.replace(/!|\$|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\'| |\"|\&|\#|\[|\]|~/g," "),r=i.match(/\S+/g),n.each(r,function(t,i){u+=n.trim(i)+" "})),i},u=function(n){for(var r=n+"=",u=document.cookie.split(";"),i=0,f=u.length,t;i<f;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""},r=function(n,t,i){var r=new Date,u;r.setTime(r.getTime()+i*864e5);u="expires="+r.toUTCString();document.cookie=n+"="+t+"; "+u},f=function(){return{nameEmailCookie:"ftscustomerEmail",nameCustomerCookie:"ftscustomerName",namePhoneCookie:"ftscustomerPhone",nameLikeCookie:"ftsCokkieLL",messageSuccess:"<span>Bình luận của bạn đã được ghi nhận<\/span>.<\/br><span>Chúng tôi sẽ phản hồi bạn sau ít phút nhé!<\/span>",imgLoading:"<img src='http://fptshop.com.vn/Content/images/ajax_loader_small.gif'>",imgBigLoading:"<img style='margin:0 auto;' src='http://fptshop.com.vn/Content/images/ajax_loader_big.gif'>",timerGetNewComment:12e4}},e=function(n){var t="",i=Math.round((new Date-n)/864e5),r=Math.round((new Date-n)/36e5,1),u=Math.round((new Date-n)/6e3,1),f=Math.round((new Date-n)/1e3,1);return t=f+" giây trước",u>0&&(t=u+" phút trước"),r>0&&(t=r+" giờ trước"),i>0&&(t=i+" ngày trước"),i>30&&(t="vào ngày "+n.getDate()+"/"+date.getMonth()+1+"/"+date.getFullYear()),t},o=function(n){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)},s=function(t){t&&n.each(t,function(t,i){n(document).find(i).val("")})},{linkAjax:t,standardizedString:i,setCookie:r,getCookie:u,configConstant:f,getBackDate:e,checkEmail:o,resetInput:s}}(jQuery);ToastFts=function(n){var t,i,r;return i=function(t){var i={background:"#71b371",img:"http://fptshop.com.vn/Content/v3/images/icon_success.png",color:"#fff"};return t.type==="Warning"&&(i.background="#C14D4D",i.img="http://fptshop.com.vn/Content/v3/images/icon_warning.png",i.color="#F7F7F7"),n(["<div class='nts-toast' style='width:298px;z-index:9999;margin: 0 auto;position: fixed;top: 50%;left: 50%;margin-left: -145px;margin-top: -26px;'>","<div class='nts-wrapper' style='border:1px #71b371 solid;background: "+i.background+";color: "+i.color+";height: auto;border-radius: 3px;-moz-border-radius: 3px;-webkit-border-radius: 3px;padding:12px 12px 10px 1px;;font-size:12px;line-height: 24px;position: relative;'>","<div class='nts-close' style='position: absolute;right: 5px;top: 0;cursor: pointer'>x<\/div>","<div class='nts-icon-success' style='position: absolute;background: url("+i.img+");width: 32px;height : 32px;left:7px'>","<\/div>","<div class='nts-content' style='padding-left: 40px;text-align: center;'>"+t.textMessage+"<\/div>","<\/div>","<\/div>"].join("\n"))},r=function(){n(document).on("click",".nts-close",function(){n("body").find(".nts-toast").fadeOut("slow",function(){setTimeout(function(){this.remove()}.bind(n(this)),1e3)})})},t=function(t){var u=n.extend({type:"success",text:"",stayTime:5e3},t),f="";f=i({textMessage:u.text,type:u.type});n("body").append(f);setTimeout(function(){n("body").find(".nts-toast").fadeOut("slow",function(){setTimeout(function(){this.remove()}.bind(n(this)),1e3)})},3e3);r()},{showToast:t}}(jQuery);window.fbAsyncInit=function(){FB.init({appId:"1468144196840722",status:!0,cookie:!0,xfbml:!0})},function(n){var t,i="facebook-jssdk",r=n.getElementsByTagName("script")[0];n.getElementById(i)||(t=n.createElement("script"),t.id=i,t.async=!0,t.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(t,r))}(document)