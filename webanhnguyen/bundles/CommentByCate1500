var Comment,UtilModule;jQuery(document).ready(function(){var n=new Comment({urlGetComment:UtilModule.linkToServer().linkGetComment,urlSendComment:UtilModule.linkToServer().linkSendComment,urlSendLikeCommnet:UtilModule.linkToServer().linkSendLikeComment,urlSendUnLikeComment:UtilModule.linkToServer().linkSendUnlikeComment,urlGetReplyComment:UtilModule.linkToServer().linkGetReplyComment});n.init()});Comment=function(n){this.urlGetComment=n.urlGetComment;this.urlSendComment=n.urlSendComment;this.urlSendLikeCommnet=n.urlSendLikeCommnet;this.urlSendUnLikeComment=n.urlSendUnLikeComment;this.urlGetReplyComment=n.urlGetReplyComment};Comment.prototype.myScrollCmt=new IScroll(".fshop-cmt-main",{scrollbars:"custom",mouseWheel:!0,interactiveScrollbars:!0,fadeScrollbars:!1});Comment.prototype.init=function(){var n=this;$(".scrollerbar").css("padding-right","15px");this.loadComment(undefined,undefined,undefined);this.SendComment();this.SendReplyComment();n.paging(undefined,undefined,undefined);n.FilterComment();n.SortComment();n.like();n.pagingReply()};Comment.prototype.loadComment=function(n,t,i){var r=this,u=n||"",f=t||0,i=i||1,e="data-page";$.ajax({type:"GET",url:r.urlGetComment,data:{cate:$(".policy-title").attr("data-catecomment"),currentPage:1,keyword:u,searchin:f,sort:i},beforeSend:function(){$("#listCommentCate").html(UtilModule.configConstant().imgLoading)}}).done(function(n){$("#listCommentCate").html(n.view);$(".fshop-cmtcount").text(n.total);$("#total-comments")&&$("#total-comments").text(n.total);n.totalRecordRest>0?$("#ntc-viewmore-comment").show().html("<span>Xem thêm <strong >0<\/strong> bình luận<\/span>").find("strong").text(n.totalRecordRest):$("#ntc-viewmore-comment").hide().attr(e,2);r.myScrollCmt.refresh()})};Comment.prototype.paging=function(n,t,i){var r=this,u=n||"",f=t||0,i=i||1;$("#ntc-viewmore-comment").off("click").on("click",function(){var n=$(this),o=$(".policy-title").attr("data-catecomment"),t="data-page",e=n.attr(t);$.ajax({type:"GET",url:r.urlGetComment,data:{cate:o,currentPage:e,keyword:u,searchin:f,sort:i},beforeSend:function(){n.html(UtilModule.configConstant().imgLoading)}}).done(function(i){$.type(i)!=="undefined"&&$.type(i)!=="null"&&($("#listCommentCate").append(i.view),i.totalRecordRest>0?(n.html("<span>Xem thêm <strong >0<\/strong> bình luận<\/span>").find("strong").text(i.totalRecordRest),n.attr(t,Number(e)+1)):n.hide().attr(t,2),r.myScrollCmt.refresh())})})};Comment.prototype.pagingReply=function(){var n=this;$(document).on("click",".reply-view-more",function(){var t=$(this),i=t.attr("data-id"),r=t.attr("data-cate"),u=t.attr("data-page"),f=t.attr("data-totalRecordRest");$.ajax({type:"GET",url:n.urlGetReplyComment,data:{cate:r,commentid:i,currentPage:u}}).done(function(i){var r=t.parent(".fshop-cmt-item").append(i).children(".reply-view-more").attr("data-page");t.parent(".fshop-cmt-item").children(".reply-view-more").attr("data-page",Number(r)+1);t.remove();n.myScrollCmt.refresh()})})};Comment.prototype.SendComment=function(){var n=this,t;$("#btnCommentCate").on("click",function(i){i.preventDefault();var s=$(this),u=$(".policy-title").attr("data-catecomment"),r=UtilModule.standardizedString($.trim($("#txt-comment-cate").val())),f=$.trim(UtilModule.getCookie("customerID")),e=$.trim(UtilModule.getCookie("customerEmail")),o=$.trim(UtilModule.getCookie("customerName"));r.length<3?UtilModule.notifyMessage(UtilModule.configConstant().messageRequireInputComment):f!==""?$.ajax({type:"POST",url:n.urlSendComment,data:{cateId:u,NewsCommentID:0,content:r,email:e,name:o},beforeSend:function(){t=UtilModule.notifyMessage(UtilModule.configConstant().messageLoading)}}).done(function(){$().toastmessage("removeToast",t);UtilModule.notifySuccessCommentCenter(UtilModule.configConstant().messageSendCommentSuccess)}):($(".fs-popup").fsPopup({opacity:.4,onClose:function(){$("#postComment").find('input[type="text"]').val("");$("#txt-comment-cate").val("")}}),$("#postComment").length>0&&$("#postComment").validate({rules:{name:{required:!0,minlength:2},email:{required:!0,email:!0}},messages:{name:{required:"Bạn cần nhập tên",minlength:"Họ và tên cần lớn hơn 2 ký tự"},email:"Bạn cần nhập email"},submitHandler:function(){return $.ajax({type:"POST",url:n.urlSendComment,data:{cateId:u,NewsCommentID:0,content:r,email:$("#postComment").find('input[name="email"]').val(),name:$("#postComment").find('input[name="name"]').val()},beforeSend:function(){$(".red-button").html(UtilModule.configConstant().imgLoading)}}).done(function(){$(".fs-popup-close").trigger("click");UtilModule.notifySuccessCommentCenter(UtilModule.configConstant().messageSendCommentSuccess)}),!1}}))})};Comment.prototype.SendReplyComment=function(){var n=this,t;$(document).on("click",".fshop-cmt-btnreply",function(){var u=$(this),i=u.attr("data-id"),r=$(".policy-title").attr("data-catecomment");$(".fshop-cmt-main").find(".fshop-cmt-hide").removeClass("fshop-cmt-show");$(this).parents(".fshop-cmt-item").find(".fshop-cmt-hide").toggleClass("fshop-cmt-show");n.myScrollCmt.refresh();$(".fshop-comment").on("click",".btn-reply-comment",function(){var s=$(this),u=UtilModule.standardizedString($("#txt-reply-comment-"+i).val()),f=$.trim(UtilModule.getCookie("customerID")),e=$.trim(UtilModule.getCookie("customerEmail")),o=$.trim(UtilModule.getCookie("customerName"));u.length<3?UtilModule.notifyMessage(UtilModule.configConstant().messageRequireInputComment):f!==""?$.ajax({type:"POST",url:n.urlSendComment,data:{cateId:r,NewsCommentID:i,content:u,email:e,name:o},beforeSend:function(){t=UtilModule.notifyMessage(UtilModule.configConstant().messageLoading)}}).done(function(){$().toastmessage("removeToast",t);UtilModule.notifySuccessCommentCenter(UtilModule.configConstant().messageSendCommentSuccess)}):($(".fs-popup").fsPopup({opacity:.4,onClose:function(){$("#postComment").find('input[type="text"]').val("");$("#txt-comment-cate").val("")}}),$("#postComment").length>0&&$("#postComment").validate({rules:{name:{required:!0,minlength:2},email:{required:!0,email:!0}},messages:{name:{required:"Bạn cần nhập tên",minlength:"Họ và tên cần lớn hơn 2 ký tự"},email:"Bạn cần nhập email"},submitHandler:function(){return $.ajax({type:"POST",url:n.urlSendComment,data:{cateId:r,NewsCommentID:i,content:u,email:$("#postComment").find('input[name="email"]').val(),name:$("#postComment").find('input[name="name"]').val()},beforeSend:function(){$(".red-button").html(UtilModule.configConstant().imgLoading)}}).done(function(){$(".fs-popup-close").trigger("click");UtilModule.notifySuccessCommentCenter(UtilModule.configConstant().messageSendCommentSuccess)}),!1}}))})})};Comment.prototype.FilterComment=function(){"use strict";var n=this,t=$("#select-condition-filter-comment"),i=$("#txt-filter-comment");t.off("change").on("change",function(){var f=$(this),t=f.find("option:selected").val(),r=UtilModule.standardizedString($.trim(i.val())),u=$(".fshop-cm-hsort").find(".active").attr("data-value");r===""&&t!=="0"?UtilModule.notifyMessage(UtilModule.configConstant().mesageRequireKeyWord):(n.loadComment(r,t,u),n.paging(r,t,u))});$("#frm-filter-content").on("submit",function(r){r.preventDefault();var o=$(this),u=t.find("option:selected").val(),f=UtilModule.standardizedString($.trim(i.val())),e=$(".fshop-cm-hsort").find(".active").attr("data-value");f===""&&u!=="0"?UtilModule.notifyMessage(UtilModule.configConstant().mesageRequireKeyWord):(n.loadComment(f,u,e),n.paging(f,u,e))})};Comment.prototype.SortComment=function(){var n=this;$(".sort-comment").on("click",function(){var t=$(this),i=t.attr("data-value"),r=$("#select-condition-filter-comment").find("option:selected").val(),u=$("#txt-filter-comment").val();t.parent().find(".active").removeClass("active");t.addClass("active");n.loadComment(u,r,i);n.paging(u,r,i)})};Comment.prototype.like=function(){var n=this;$(document).on("click",".fshop-cmt-btnlike",function(){var r=$(this),t=r.next(".fshop-cmt-numlike"),u=t.attr("data-id"),i=t.children(".number-like");t.hasClass("liked")?(t.removeClass("liked"),i.text(Number(i.text())-1),r.text("thích"),$.post(n.urlSendUnLikeComment,{CommentID:u})):(t.addClass("liked"),i.text(Number(i.text())+1),r.text("bỏ thích"),$.post(n.urlSendLikeCommnet,{CommentID:u}))})};UtilModule=function(){var n,t,i,r,u,f;return n=function(){return{linkGetComment:"/Ajax/Comment/ListCommentByCate",linkGetReplyComment:"/Ajax/Comment/ListReplyCommentByCate",linkSendComment:"/Ajax/NewsComment/AddCommentCate",linkSendLikeComment:"/Ajax/NewsComment/Like",linkSendUnlikeComment:"/Ajax/NewsComment/UnLike"}},t=function(){return{imgLoading:"<img src='/Content/images/ajax_loader_small.gif'>",messageRequireInputComment:"<p>Bạn cần nhập nội dung lớn hơn 3 ký tự<\/p>",mesageRequireKeyWord:"Bạn chưa nhập từ khóa",messageLoading:"<p>Đang xử lý dữ liệu...<\/p>",messageSendCommentSuccess:"Bình luận của bạn đang được xử lý và sẽ được phản hồi trong 30 phút"}},i=function(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""},r=function(n){$().toastmessage("showToast",{text:n,sticky:!1,position:"middle-center",type:"success",closeText:"",close:function(){$("#txt-comment-cate").val("");$('[id^="txt-reply-comment-"]').val("").closest(".fshop-cmt-reply").removeClass("fshop-cmt-show")}})},u=function(n){return $().toastmessage("showToast",{text:n,sticky:!1,position:"middle-center",type:"notice",closeText:"",close:function(){}})},f=function(n){var t=n,r="",i;return t!==""&&(t=t.replace(/!|\$|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\'| |\"|\&|\#|\[|\]|~/g," "),i=t.match(/\S+/g),$.each(i,function(n,t){r+=$.trim(t)+" "})),t},{linkToServer:n,configConstant:t,getCookie:i,notifySuccessCommentCenter:r,notifyMessage:u,standardizedString:f}}()